(function(e,t){"use strict";var n;n={};n.configure=function(e){n.Controller.read=e.read||function(){};n.Controller.write=e.write||function(){};if(e.strategy){n.Strategy._fn=e.strategy}if(e.agents){n.Agents._list=e.agents}return n};n.run=function(){n.Controller.load();n.Dispatcher._list=n.Strategy.run();n.Dispatcher.run();return this};n.debug=function(){var e;for(e in n){if(typeof n[e]==="object"){n[e]._debug()}}};n.Agents={};n.Agents._debug=function(){};n.Agents.Abstract=function(e){this._name=e||"unknown";this.init=function(){var e,r=n.Controller.request();if(t!==r.agents[this._name]){for(e in r.agents[this._name]){this[e]=r.agents[this._name][e]}}};this.update=function(e){var r,i={};for(r in this){if("function"===typeof this[r]){continue}if("string"===typeof r){if("_"===r[0]){continue}}i[r]=this[r]}n.Controller.requestPart(this._name,i);if(t===e||true!==e){n.Controller.save()}};this.destroy=function(e){var r;delete n.Dispatcher._dispatched[this._name];r=n.Dispatcher._list.indexOf(this._name);n.Dispatcher._list.splice(r,1);if(t===e||true!==e){n.run()}}};n.Strategy={};n.Strategy._fn=function(){};n.Strategy.run=function(){return this._fn(n.Controller.request())};n.Strategy._debug=function(){};n.Dispatcher={};n.Dispatcher.run=function(){var e,r,i,s,o;this._dispatched={};for(e=0;e<this._list.length;e++){s=this._list[e];o=n.Agents._list[s];if(t===o){throw"Invalid object key"}i=new n.Agents.Abstract(s);i.init(n.Controller.request());if("function"===typeof o){i.run=n.Agents._list[this._list[e]]}if("object"===typeof o){for(r in o){i[r]=n.Agents._list[this._list[e]][r]}}if("function"!==typeof i.run){throw"Agent "+this._list[e]+" missing run function."}i.init();i.run();this._dispatched[this._list[e]]=i}};n.Dispatcher._debug=function(){console.log("dispatchable",this._list);console.log("dispatched",this._dispatched)};n.Controller={_request:{}};n.Controller.load=function(){n.Controller._request=JSON.parse(n.Controller.read());if(t===this._request.agents){this._request.agents={}}};n.Controller.read=function(){};n.Controller.write=function(){};n.Controller.save=function(){n.Controller.write(n.Controller.request())};n.Controller.request=function(){return n.Controller._request};n.Controller.requestPart=function(e,n){if(t===n){return this._request.agents[e]}this._request.agents[e]=n;return true};n.Controller._debug=function(){var e,t;if("function"!==typeof console.log){alert("No console available.")}console.log("request",this._request);for(e in this._request.agents){console.log("  request agent: "+e);for(t in this._request.agents[e]){if("function"!==typeof this._request.agents[e][t]){console.log("    "+t+" ",this._request.agents[e][t])}}}};e.Sup=n})(window)
